<!DOCTYPE html>
<html>
<body>

<input type='file' style='display:none'/>

<!-- https://pixelsvsbytes.com/2013/02/js-require-for-browsers-better-faster-stronger/ -->
<script src='require.min.js'></script>

<scriptx src='page-bsp.js'></scriptx>
<script>
  const bsp = Tarp.require('./bsp.js');
  const phosphor = bsp.newPhosphor();
  phosphor.reboot();
</script>

<h1>Phosphor Microcomputer (Under Construction)</h1>

<p>A browser-based microcomputer inspired by:</p>

<ul>
  <li>Commodore 64 (BASIC programming language and games)</li>
  <li>LOGO (programmable pen turtle graphics)</li>
  <li>Unix / Linux / Raspberry Pi (terminal, shell, filesystem, text processing)</li>
  <li>LÃ–VE (Lua engine for 2D games)</li>
  <li>PICO-8 (and similar fantasy consoles with builtin editors)</li>
  <li>Game Boy (simple games with simple controls)</li>
</ul>

<h1>Instructions</h1>

<p>Type commands in the console (command line). Type 'scale n' where n is an integer (1, 2, 3...) to change the scale of the display. Type 'reboot' or reload the page to reboot the microcomputer.</p>

<p>Hit ESCAPE to toggle edit mode on and off, or CTRL-1 through CTRL-5 to go directly to the editors (code, sprite, map, sound, music; only the code editor works right now). Hit CTRL-` to go directly to the console.</p>

<p>You can type a Lua program in the code editor (CTRL-1) and in the console (CTRL-`) type 'run' to run it.</p>

<p>Type 'load hello' then 'run' to load and run this simple demo text program:</p>

<pre>
-- hello (demo)
write('What is your name? ')
name = read()
print('Hello', name)
</pre>

<p>Type 'load bounce' then 'run' to load and run this simple demo graphics program:</p>

<pre>
-- bounce (demo)
r,d = 4,8
x,y = 96,64
dx,dy = 2,1

function update()
  x,y = x+dx,y+dy
  if x < d or 192-d < x then dx = -dx end
  if y < d or 128-d < y then dy = -dy end
end

function draw()
  clear(5)
  rect(x-r, y-r, d, d, 11)
end
</pre>

<p>Type 'help' for more commands.</p>

<p>These graphics syscalls work as expected:</p>

<pre>
clear(c) -- clear screen

pget(x, y) -- get pixel at x,y
pset(x, y, c) -- set pixel at x,y

line(x1, y1, x2, y2, c) -- draw line from x1,y1 to x2,y2
rect(x, y, w, h, c1, c2) -- draw rect at x,y with size w,h
circle(x, y, r, c1, c2) -- draw circle at x,y with radius r

char(ch, x, y, c1, c2) -- draw char ch at x,y
text(str, x, y, c1, c2) -- draw string str at x,y

sprite(n, x, y) -- draw sprite n at x,y
sget(n, x, y) -- get pixel from sprite n
sset(n, x, y, c) -- set pixel in sprite n

map(x, y, mx, my, mw, mh) -- draw map (cells at mx,my size mw,mh) at x,y
mget(x, y) -- get map value at cell x,y
mset(x, y, n) -- set map value at cell x,y
</pre>

<p>Input, for printable ASCII keys only (e.g. 'y' or 'n' but not cursor or shift), can be obtained like:</p>

<pre>
keyp('y') -- true the first frame key 'y' is pressed
keyr('y') -- true the first frame key 'y' is released
key('y') -- true all frames key 'y' is being pressed
key('y', delay, rate) -- true if key 'y' is repeating, which occurs:
    -- first frame, after delay frames, then every rate frames)
</pre>

<p>Please note that at this point, nothing finalized, everything is subject to change.</p>

<h1>Changelog</h1>

<h2>2018-03-29</h2>

<pre>
- add input syscalls: keyp, keyr
- add repeat delay and rate to key syscall
- disable reboot syscall for now
</pre>

<h2>2018-03-24</h2>

<pre>
- rename syscall: spr to sprite
- add graphics syscalls: pget, pset, line, circle
- remove ui sprite syscalls: uget, uset, uspr
- apply MIT license
- code cleanup
</pre>

<h2>2018-03-20</h2>

<pre>
- use "phosphor" as name
- some code cleanup
</pre>

<h2>2018-03-19</h2>

<pre>
- serialize memory without swapping nibbles
- store memory sections in program file
- change import/export commands to importfs/exportfs (for filesystem)
- make new import/export commands (for individual files)
- add mv and rm file commands
- more visual tweaks
</pre>

<h2>2018-03-18</h2>

<pre>
- map editor visual overhaul
- map editor added features (pane splitter, zoom)
- improve drag and touch support
</pre>

<h2>2018-03-15</h2>

<pre>
- start map editor
- rewrite rect syscall
- add syscalls: mset, mget, map
- convert from onMouseWheel to onWheel
- tweak bounce demo
</pre>

<h2>2018-03-12</h2>

<pre>
- add last used graphics state (colors and palette)
- add (incomplete) palette mapping and transparency
- improve char/text syscalls
- add character rom (and remove font loading from PNG)
- use custom characters instead of ui sprites
- add icons to sprite editor
- add paging to sprite sheet (can edit all sprites now)
- tweak bounce demo
</pre>

<h2>2018-03-11</h2>

<pre>
- change video ram and fragment shader to pack two pixels per byte
- add memory syscalls: peek, poke, memcpy, memset, memread, memwrite
- add sprite syscalls: sget, sset, spr
- add ui sprite syscalls: uget, uset, uspr
- save memory image to web local storage
- add ui module
- improve sprite editor
- visual refresh
</pre>

<h2>2018-03-04</h2>

<pre>
- convert to WebGL
</pre>

<h2>2018-02-25</h2>

<pre>
- add simple key events
- add simple mouse events
- add syscall for rect outline
- start sprite editor
</pre>

<h2>2018-02-24</h2>

<pre>
- add scale command
- add proper path resolution (cd, ls)
- add mkdir and rmdir commands
- add reboot command
</pre>

<h2>2018-02-03</h2>

<pre>
- use web local storage for filesystem
- move demo programs (hello and bounce) into filesystem
- add load command and improve run command
- first cut at cd and ls commands
- change export/import commands to operate on entire filesystem (as JSON)
- improve read syscall for terminal and files
</pre>

<h2>2018-01-26</h2>

<pre>
- code editor and export/import only work on single 'program.lua' file
- 'lua' (or 'run') command runs 'program.lua' file
- 'lua name' command runs test Lua text program (hello)
- 'lua test' command runs test Lua graphics program (bounce)
- 'echo' command runs test shell command
- 'cat' command runs test JavaScript text program
- CTRL-8 runs test JavaScript graphics program (bounce)
</pre>

</body>
</html>